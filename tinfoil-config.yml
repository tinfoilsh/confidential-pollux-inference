shim-version: v0.2.15@sha256:5ca748b384b78b7e686b57ca66d9b3c552038ebab2ce60305004f76e573a8458
cvm-version: 0.5.9
cpus: 16
memory: 262144
gpus: full

containers:
  - name: "gcsfuse"
    image: ""
    args: [
      "--cap-add", "SYS_ADMIN",
      "--device", "/dev/fuse",
      "--security-opt", "apparmor=unconfined",
      "-v", "/mnt/ramdisk/gcs-bucket:/gcs:rshared",
      "-v", "/mnt/ramdisk/gcloud_key.json:/key.json:ro",
      "-e", "BUCKET_NAME=pollux-enc-prod",
      "kapetacom/gcsfuse-ubuntu:v3.2.0"
    ]

  # Pollux inference container (reads models/adapters via gcsfuse mount)
  - name: "ml-inference"
    image: ""
    args: [
      "--runtime", "nvidia",
      "--gpus", "all",
      "--ipc", "host",
      "--entrypoint", "python",
      "-v", "/mnt/ramdisk/gcs-bucket:/mnt/gcs:ro",
      "-v", "/mnt/ramdisk/gcloud_key.json:/key.json:ro",
      "-e", "GOOGLE_APPLICATION_CREDENTIALS=/key.json",
      "-e", "GCS_BUCKET=pollux-enc-prod",
      "-e", "POLLUX_LN_GCS_BUCKET=gs://pollux-enc-prod",
      "-e", "POLLUX_GCSFUSE_MOUNT_PATH=/mnt/gcs",
      "-e", "KEY_MODE=real_keys",
      "us-central1-docker.pkg.dev/workshop-labs-pbc/pollux-docker/ml-inference@sha256:1d8b6772dbbb44110ee737040d200b711ddab763b9fe028e8caf7c3230a9e083",
      "-m", "scripts.inference_server",
      "unsloth-hermes4-70b"
    ]

shim:
  listen-port: 443
  upstream-port: 8000
  publish-attestation: true
  tls-challenge: dns
  paths:
    - /v1/chat/completions
    - /ping
    - /v1/loaded_model
    - /v1/metrics/vllm/full
    - /v1/metrics/short
    - /v1/downloaded_models
